# ДЗ. Урок 6. Анализ «что если». Надстройки MS Excel
## Условие задания 1:
1. Вы инвестируете в новый мюзикл. У Вас есть следующая информация о постановке:
● Постоянные затраты на первое представление пьесы составляют 50 млн. рублей.
● Средняя цена билета - 3500 рублей.
● Театр вмещает 2000 человек, и представления идут 365 дней в году.
Создайте таблицу данных, в которой определяется, как общий доход от постановки изменяется при
продолжительности проката пьесы от 1 года до 5 лет и при средней наполненности зала, меняющейся
от 70% до 90%.
2. Создайте сценарии для малого среднего числа посетителей (50%), наиболее вероятного (75%) и
большого числа посетителей (90%).

## Условие задания 2:
Планируется взять кредит в 5 000 000 рублей на 20 лет и вносить равные ежегодные платежи в
начале каждого года. Определите процентную ставку для данных условий.
Дополнительное задание*: Определите процентную ставку, если платежи должны вноситься ежемесячно
в размере 90 000 рублей (кроме последнего платежа).

## Условие задания 3:
Завод производит мыши, клавиатуры и джойстики для видеоигр. В таблице приведена прибыль с единицы продукции, количество рабочего времени, затрачиваемое
на единицу продукции, ежемесячный спрос на продукты и количество машинного времени, затрачиваемое на единицу продукции.
Каждый месяц доступно в общей сложности 13 000 часов рабочего времени и 3000 часов машинного времени. Каким образом завод может максимизировать ежемесячную прибыль?

# Решение
## Задание 1
[01.xlsx](https://github.com/allseenn/excel/blob/main/06.Tasks/01.xlsx) Создадим и заполним слева "таблицу значений" из задания:
- Первое вложение: 50 000 000 рублей
- Средняя цена билета: 3 500 рублей
- Вместимость театра: 2000 человек
- Заполненность %: 100%
- Дней в году: 365
- Длительность лет: 1
- Прибыль за год: ссылка на формулу
Справа "таблицу данных" заполним следующим образом:
- Заголовки столбцов содержат длительность премьеры  от 1 до 5 лет
- Заголовки строк содержат заполненность театра в процентах 70, 80, 90
- Ячейка пересечения заголовков содержит формулу расчета прибыли: =$B$2*$B$3*B4*$B$5*B6-$B$1
Формула рассчитывается как произведение средней цены билета на полную вместимость театра на процент заполненности на количество дней в году и длительность лет за минусом первого вложения. 
### Пункт 1 здание 1
- Выделяем "таблицу данных" вместе с заголовками по строкам и столбцам с ячейкой на пересечении, содержащей нашу формулу
- С помощью инструмента "Анализ что если", выбрав пункт "таблица данных" укажем ячейки изменяемых параметров, по строкам: "процент заполненности театра", по столбцам: "количество лет"
- Надстройка, автоматически подставит значения "длительность лет" в формулу из заголовков столбцов "таблицы данных"
- Надстройка, автоматически подставит значения "процент заполненности" в формулу из заголовков строк "таблицы данных"
### Пункт 2 здание 1
Создадим 3 сценария с помощью инструмента "Анализ что если" - "Диспетчер сценариев", для одно изменяемого параметра "процент заполненности" "таблицы значений":
- Small: минимальное число посетителей 50%
- Middle: наиболее вероятное число посетителей 75%
- Big: большое число посетителей 90%
При запуске одного из сценариев прибыль в "таблице значений" будет меняться.
## Задание 2
[02.xlsx](https://github.com/allseenn/excel/blob/main/06.Tasks/02.xlsx) Вверху создадим таблицу "Условие 1" и внесем значения из первого условия задачи:
- сумма кредита: 5 000 000 рублей
- срок кредита лет: 20
- ежегодный взнос: 500 000 рублей (изменяемое значение)
- процентная ставка: искомое поле
### Пункт 1 здание 2
Процентную ставку вычислим в ячейке значения поля "процентная ставка" таблицы "Условие 1", с помощью финансовой функции СТАВКА, содержащей следующие аргументы:
- кредитный период
- регулярный платеж
- сумма кредита
- выплата в начале или в конце периода
В полученной таблицы можно изменять величину ежегодного взноса и параметр процентный ставки будет вычисляться автоматически.
### Пункт 2 здание 2
Ниже под таблицей "Условие 1" создадим таблицу "Условие 2 и внесем значения из второго условия задачи:
- сумма кредита: 5 000 000 рублей
- срок кредита лет: 20
- срок кредита в месяцах: 240 (вычисляемое поле, т.к. по условию 2 выплаты производятся ежемесячно)
- ежемесячный взнос: 90 000 рублей
- процентная ставка: вычисляемое поле (опционально)
- процентная ставка кроме последнего месяца
Аналогично первому условию, процентную ставку вычислим в ячейке значения поля "процентная ставка" таблицы "Условие 2", с помощью финансовой функции СТАВКА, содержащей следующие аргументы:
- кредитный период
- регулярный платеж
- сумма кредита
- остаток на конец периода
- выплата в начале или в конце периода
Т.к. по второму условию последний платеж совершать не надо, то остаток на счету -90 т.р. задается в функции СТАВКА с помощью аргумента остаток на конец периода, который в свою очередь является ссылкой на ячейку "ежемесячный взнос". Увеличим разряд процента, до десятитысячных после запятой видно, что процентная ставка меньше, той которую нужно было бы платить полностью.
## Задание 3
### Описание проблемы
Основная проблема данного задания в большом разнообразие продукции, в комбинации различного времени ручного и машинного производства для каждого вида продукции, явно заданных ограничений в виде максимального времени на ручной труд и на машинное производство, есть и косвенные ограничения в виде рыночного спроса на тот или иной товар. В случае перепроизводства, такой товар можно считать выкинутым на свалку, т.к. по условию не сказано о наличии склада, только есть завод или цех.
Данную задачу можно решить только методами линейного программирования.
Линейное программирование - это технология по оптимизации функций линейных задач, где субъективные факторы представлены в виде линейно-равных или линейно-неравных ограничений.
Для решения нашего задания необходимо построить линейную модель, состоящую из следующих этапов:
1. Определить переменные:
- А - количество мышек производимых за месяц
- B - количество клавиатур производимых за месяц
- С - количество джойстиков производимых за месяц
2. Определить цели и составить выражение содержащую наши переменные:
Максимальная прибыль = 8А + 11B + 9C
3. Определить явные ограничения и составить для каждого из них свое выражение:
Ограничение рабочего времени: 0.2А + 0.3В + 0.24С <= 13 000
Ограничение машинного времени: 0.04А + 0.55В + 0.04С <= 3 000
4. Определить косвенные ограничения:
Косвенные ограничения явно не указываются в задании как ограничения, но по смыслу понятно, что мы не сможем реализовать товара больше чем требует рынок:
- Мыши: 0 <= A <= 15 000
- Клавиатуры: 0 <= B <= 29 000
- Джойстики: 0 <= С <= 11 000
В классическом линейном программирование пришлось бы строить графики всевозможных областей для каждого неявного и явного ограничения, изображая векторами приближенные градиенты функций для наших искомых целей (максимальная прибыль, необходимое количество производимого товара для каждого продукта, количество времени как машинного, так и ручного необходимого для каждого вида продукции). Такие графики практически невозможно построить имея более двух переменных.
Но, к счастью у нас есть надстройка в MS Excel "Поиск решений", которая всю работу по поиску решений сделает автоматически.
### Заполенине таблицы данными
[03.xlsx](https://github.com/allseenn/excel/blob/main/06.Tasks/01.xlsx) Создадим и заполним таблицу, состоящую из трех частей:
1. Основная информация
2. Переменные - коричневая заливка
3. Расчеты - зеленая заливка
#### 1. Основная информация
Данные берем из презентации к семинару 6, домашнее задание 2. Заливаем ячейки оттенками синего цвета. Темно-синий оттенок выделяет ячейки, которые будут участвовать в расчетах
#### 2. Переменные
Переменные значения количества продуктов подставятся автоматически с помощью "Поиска решений", на основе алгоритма из пункта 1 "Описание проблемы" данного руководства.
#### 3. Расчеты
В данном разделе содержатся основные формулы из раздела "Описание проблемы"
- Ячейка прыбыль: =$C$5*$C$10+$D$5*$D$10+$E$5*$E$10, на основе пункта 2 раздела "Описание проблемы"
- Явное ограничение раб.времени: =СУММПРОИЗВ($C$6:$E$6;$C$10:$E$10), на основе пункта 3 раздел "Описание проблемы"
- Явное ограничение маш.времени: =СУММПРОИЗВ($C$7:$E$7;$C$10:$E$10), на основе пункта 3 раздел "Описание проблемы"
Функция СУММПРОИЗВ перемножает соответствующие элементы массивов и полученные результат складывает.
### Поиск решения
Запускаем меню надстройки "Поиск решений" и вносим следующие параметры:
- "Целевая функция" будет ссылатся на формулу из ячейки прибыль $C$12
- Переключатель оставляем на "Максимум", т.к. мы ищем максимальную прибыль
- "Изменяя ячейки переменных" ссылаются на темно коричневые ячейки раздела таблицы "Переменные" $C$10:$E$10
- Ограничение для диапазона количества продукции С10:E10 = целое, т.к. товар не может быть продан частично, только целый
- Явное ограничение рабочего времени С14 <= E14
- Явное ограничение машинного времени С15 <= E15
- Производство мышек не может превышать максимального спроса С10 <= C8
- Производство клавиатур не может превышать максимального спроса D10 <= D8
- Производство джойстиков не может превышать максимального спроса E10 <= E8
- Оставляем галку на "Сделать переменные без ограничений неотрицательными"
- Выбираем поиск решения линейных задач симплекс-методом 
### Решение
После нажатия кнопки "Найти решение", выбираем "Сохранить решение" и ОК.
В результате в таблице, красным шрифтом выделены параметры (значения), которые поменялись в ходе "поиска решения":
- Переменное количество мышек 
- Переменное количество клавиатур
- Переменное количество джойстиков 
Жирным красным шрифтом помечены основные параметры:
- Рабочее время
- Машинное время
- Прибыль
Зная перечисленные параметры, завод может максимизировать прибыль от производства.